"use strict";var t,e=require("avalanche-js-crypto"),r=require("avalanche-js-utils"),n=require("avalanche-js-account"),a=(t=require("regenerator-runtime"))&&"object"==typeof t&&"default"in t?t.default:t,i=require("avalanche-js-transaction"),o=require("avalanche-js-network");function s(t,e,r,n,a,i,o){try{var s=t[i](o),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,a)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(n,a){var i=t.apply(e,r);function o(t){s(i,n,a,o,c,"next",t)}function c(t){s(i,n,a,o,c,"throw",t)}o(void 0)}))}}function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}).apply(this,arguments)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=new e.BN(-1),f=new e.BN(1),d=new e.BN(0),p=r.hexToBN("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),y=new RegExp(/^bytes([0-9]*)$/),v=new RegExp(/^(u?int)([0-9]*)$/),m=new RegExp(/^(.*)\[([0-9]*)\]$/),g=function(t,e){var r=t.match(v);return r&&parseInt(r[2],10)<=48?e.toString("hex"):e};function b(t){return t.match(/^uint($|[^1-9])/)?t="uint256"+t.substring(4):t.match(/^int($|[^1-9])/)&&(t="int256"+t.substring(3)),t}function w(t,e){var r=t;function n(t){throw new Error('unexpected character "'+r[t]+'" at position '+t+' in "'+r+'"')}t=t.replace(/\s/g," ");for(var a={type:"",name:"",state:{allowType:!0}},i=a,o=0;o<t.length;o++){var s=t[o];switch(s){case"(":i.state&&i.state.allowParams||n(o),i.state&&(i.state.allowType=!1),i.type&&(i.type=b(i.type)),i.components=[{type:"",name:"",parent:i,state:{allowType:!0}}],i=i.components[0];break;case")":delete i.state,e&&"indexed"===i.name&&(i.indexed=!0,i.name=""),i.type&&(i.type=b(i.type));var c=i;(i=i.parent)||n(o),delete c.parent,i.state&&(i.state.allowParams=!1,i.state.allowName=!0,i.state.allowArray=!0);break;case",":delete i.state,e&&"indexed"===i.name&&(i.indexed=!0,i.name=""),i.type&&(i.type=b(i.type));var u={type:"",name:"",parent:i.parent,state:{allowType:!0}};i.parent.components.push(u),delete i.parent,i=u;break;case" ":i.state&&(i.state.allowType&&""!==i.type&&i.type&&(i.type=b(i.type),delete i.state.allowType,i.state.allowName=!0,i.state.allowParams=!0),i.state.allowName&&""!==i.name&&(e&&"indexed"===i.name?(i.indexed=!0,i.name=""):i.state.allowName=!1));break;case"[":i.state&&i.state.allowArray||n(o),i.state&&(i.type+=s,i.state.allowArray=!1,i.state.allowName=!1,i.state.readArray=!0);break;case"]":i.state&&i.state.readArray||n(o),i.state&&(i.type+=s,i.state.readArray=!1,i.state.allowArray=!0,i.state.allowName=!0);break;default:i.state&&(i.state.allowType?(i.type+=s,i.state.allowParams=!0,i.state.allowArray=!0):i.state.allowName?(i.name+=s,delete i.state.allowArray):i.state.readArray?i.type+=s:n(o))}}if(i.parent)throw new Error("unexpected eof");return delete a.state,e&&"indexed"===i.name&&(i.indexed=!0,i.name=""),a.type&&(a.type=b(a.type)),a}var E=function(t,e,r,n,a){this.coerceFunc=t,this.name=e,this.type=r,this.localName=n,this.dynamic=a},I=function(t){function e(e){var r;return(r=t.call(this,e.coerceFunc,e.name,e.type,void 0,e.dynamic)||this).coder=e,r}h(e,t);var r=e.prototype;return r.encode=function(t){return this.coder.encode(t)},r.decode=function(t,e){return this.coder.decode(t,e)},e}(E),N=function(t){function r(e,r){return t.call(this,e,"null","",r,!1)||this}h(r,t);var n=r.prototype;return n.encode=function(t){return e.arrayify([])||new Uint8Array},n.decode=function(t,e){if(e>t.length)throw new Error("invalid null");return{consumed:0,value:this.coerceFunc("null",void 0)}},r}(E),x=function(t){function n(e,r,n,a){var i,o=(n?"int":"uint")+8*r;return(i=t.call(this,e,o,o,a,!1)||this).size=r,i.signed=n,i}h(n,t);var a=n.prototype;return a.encode=function(t){var r;try{var n;if(n="string"==typeof t&&t.startsWith("0x")?new e.BN(t.slice(2),"hex"):new e.BN(t),this.signed){var a=p.maskn(8*this.size-1);if(n.gt(a))throw new Error("out-of-bounds");if(a=a.add(f).mul(l),n.lt(a))throw new Error("out-of-bounds")}else if(n.lt(d)||n.gt(p.maskn(8*this.size)))throw new Error("out-of-bounds");n=n.toTwos(8*this.size).maskn(8*this.size),this.signed&&(n=n.fromTwos(8*this.size).toTwos(256));var i=n.toString("hex");r=e.padZeros(e.arrayify("0x"+i)||new Uint8Array,32)}catch(r){e.throwError("invalid number value",e.INVALID_ARGUMENT,{arg:this.localName,coderType:this.name,value:t})}return r||e.padZeros(new Uint8Array,32)},a.decode=function(t,n){t.length<n+32&&e.throwError("insufficient data for "+this.name+" type",e.INVALID_ARGUMENT,{arg:this.localName,coderType:this.name,value:e.hexlify(t.slice(n,n+32))});var a=e.hexlify(t.slice(n+(32-this.size),n+32)),i=r.hexToBN(a);return i=this.signed?i.fromTwos(8*this.size):i.maskn(8*this.size),{consumed:32,value:this.coerceFunc(this.name,i)}},n}(E),A=new x((function(t,e){return e}),32,!1,"none"),T=function(t){function r(e,r){return t.call(this,e,"bool","bool",r,!1)||this}h(r,t);var n=r.prototype;return n.encode=function(t){return A.encode(new e.BN(t?1:0))},n.decode=function(t,r){var n;try{n=A.decode(t,r)}catch(t){throw"insufficient data for uint256 type"===t.reason&&e.throwError("insufficient data for boolean type",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"boolean",value:t.value}),t}return{consumed:n.consumed,value:this.coerceFunc("bool",!n.value.isZero())}},r}(E),k=function(t){function r(e,r,n){var a,i="bytes"+r;return(a=t.call(this,e,i,i,n,!1)||this).length=r,a}h(r,t);var n=r.prototype;return n.encode=function(t){var r=new Uint8Array(this.length);try{var n,a=e.arrayify(t);if(null===a)throw new Error("cannot arraify data");var i=e.hexlify(a);if(null===(n=e.arrayify(e.bytesPadRight(i,this.length)))||n.length!==this.length)throw new Error("incorrect data length");r.set(n)}catch(r){e.throwError("invalid "+this.name+" value",e.INVALID_ARGUMENT,{arg:this.localName,coderType:this.name,value:r.value||t})}return r},n.decode=function(t,r){return t.length<r+32&&e.throwError("insufficient data for "+name+" type",e.INVALID_ARGUMENT,{arg:this.localName,coderType:this.name,value:e.hexlify(t.slice(r,r+32))}),{consumed:32,value:this.coerceFunc(this.name,e.hexlify(t.slice(r,r+this.length)))}},r}(E),M=function(t){function r(e,r){return t.call(this,e,"address","address",r,!1)||this}h(r,t);var n=r.prototype;return n.encode=function(t){var r=new Uint8Array(32);try{var n=e.arrayify(e.toChecksumAddress(t))||new Uint8Array;r.set(n,12)}catch(r){e.throwError("invalid address",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"address",value:t})}return r},n.decode=function(t,r){return t.length<r+32&&e.throwError("insufficuent data for address type",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"address",value:e.hexlify(t.slice(r,r+32))}),{consumed:32,value:this.coerceFunc("address",e.toChecksumAddress(e.hexlify(t.slice(r+12,r+32))))}},r}(E);function C(t){var r=32*Math.ceil(t.length/32),n=new Uint8Array(r-t.length);return e.concat([A.encode(new e.BN(t.length)),t,n])}function D(t,r,n){t.length<r+32&&e.throwError("insufficient data for dynamicBytes length",e.INVALID_ARGUMENT,{arg:n,coderType:"dynamicBytes",value:e.hexlify(t.slice(r,r+32))});var a=A.decode(t,r).value;try{a=a.toNumber()}catch(t){e.throwError("dynamic bytes count too large",e.INVALID_ARGUMENT,{arg:n,coderType:"dynamicBytes",value:a.toString()})}return t.length<r+32+a&&e.throwError("insufficient data for dynamicBytes type",e.INVALID_ARGUMENT,{arg:n,coderType:"dynamicBytes",value:e.hexlify(t.slice(r,r+32+a))}),{consumed:32+32*Math.ceil(a/32),value:t.slice(r+32,r+32+a)}}var F=function(t){function r(e,r){return t.call(this,e,"bytes","bytes",r,!0)||this}h(r,t);var n=r.prototype;return n.encode=function(t){var r=new Uint8Array;try{r=C(e.arrayify(t)||new Uint8Array)}catch(t){e.throwError("invalid bytes value",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"bytes",value:t.value})}return r},n.decode=function(t,r){var n=D(t,r,this.localName||"");return n.value=this.coerceFunc("bytes",e.hexlify(n.value)),n},r}(E),P=function(t){function r(e,r){return t.call(this,e,"string","string",r,!0)||this}h(r,t);var n=r.prototype;return n.encode=function(t){return"string"!=typeof t&&e.throwError("invalid string value",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"string",value:t}),C(_(t))},n.decode=function(t,e){var r=D(t,e,this.localName||"");return r.value=this.coerceFunc("string",V(r.value)),r},r}(E);function R(t){return 32*Math.ceil(t/32)}function S(t,r){if(Array.isArray(r));else if(r&&"object"==typeof r){var n=[];t.forEach((function(t){n.push(r[t.localName||""])})),r=n}else e.throwError("invalid tuple value",e.INVALID_ARGUMENT,{coderType:"tuple",value:r});t.length!==r.length&&e.throwError("types/value length mismatch",e.INVALID_ARGUMENT,{coderType:"tuple",value:r});var a=[];t.forEach((function(t,e){a.push({dynamic:t.dynamic,value:t.encode(r[e])})}));var i=0,o=0;a.forEach((function(t){t.dynamic?(i+=32,o+=R(t.value.length)):i+=R(t.value.length)}));var s=0,c=i,u=new Uint8Array(i+o);return a.forEach((function(t){t.dynamic?(u.set(A.encode(new e.BN(c)),s),s+=32,u.set(t.value,c),c+=R(t.value.length)):(u.set(t.value,s),s+=R(t.value.length))})),u}function L(t,e,r){var n=r,a=0,i=[];return t.forEach((function(t){var o;if(t.dynamic){var s=A.decode(e,r);(o=t.decode(e,n+s.value.toNumber())).consumed=s.consumed}else o=t.decode(e,r);void 0!==o.value&&i.push(o.value),r+=o.consumed,a+=o.consumed})),t.forEach((function(t,e){var r=t.localName;r&&("length"===r&&(r="_length"),null==i[r]&&(i[r]=i[e]))})),{value:i,consumed:a}}var O,B=function(t){function r(e,r,n,a){var i;return(i=t.call(this,e,"array",r.type+"["+(n>=0?n:"")+"]",a,-1===n||r.dynamic)||this).coder=r,i.length=n,i}h(r,t);var n=r.prototype;return n.encode=function(t){Array.isArray(t)||e.throwError("expected array value",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"array",value:t});var r=this.length,n=new Uint8Array(0);-1===r&&(n=A.encode(new e.BN(r=t.length))),e.checkArgumentCount(r,t.length," in coder array"+(this.localName?" "+this.localName:""));for(var a=[],i=0;i<t.length;i++)a.push(this.coder);return e.concat([n,S(a,t)])},n.decode=function(t,r){var n=0,a=this.length,i={consumed:0,value:void 0};if(-1===a){try{i=A.decode(t,r)}catch(t){e.throwError("insufficient data for dynamic array length",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"array",value:t.value})}try{a=i.value.toNumber()}catch(t){e.throwError("array count too large",e.INVALID_ARGUMENT,{arg:this.localName,coderType:"array",value:i.value.toString()})}n+=i.consumed,r+=i.consumed}for(var o=[],s=0;s<a;s++)o.push(new I(this.coder));var c=L(o,t,r);return c.consumed+=n,c.value=this.coerceFunc(this.type,c.value),c},r}(E),U=function(t){function e(e,r,n){var a,i=!1,o=[];r.forEach((function(t){t.dynamic&&(i=!0),o.push(t.type)}));var s="tuple("+o.join(",")+")";return(a=t.call(this,e,"tuple",s,n,i)||this).coders=r,a}h(e,t);var r=e.prototype;return r.encode=function(t){return S(this.coders,t)},r.decode=function(t,e){var r=L(this.coders,t,e);return r.value=this.coerceFunc(this.type,r.value),r},e}(E),j={address:M,bool:T,string:P,bytes:F};function G(t,r){var n=j[r.type];if(n)return new n(t,r.name);var a=r.type.match(v);if(a){var i=parseInt(a[2]||"256",10);return(0===i||i>256||i%8!=0)&&e.throwError("invalid "+a[1]+" bit length",e.INVALID_ARGUMENT,{arg:"param",value:r}),new x(t,i/8,"int"===a[1],r.name||"")}var o=r.type.match(y);if(o){var s=parseInt(o[1],10);return(0===s||s>32)&&e.throwError("invalid bytes length",e.INVALID_ARGUMENT,{arg:"param",value:r}),new k(t,s,r.name||"")}var c=r.type.match(m);if(c){var u=parseInt(c[2]||"-1",10);return(r=function(t){var e={};for(var r in t)e[r]=t[r];return e}(r)).type=c[1],r=q(r),new B(t,G(t,r),u,r.name||"")}return"tuple"===r.type.substring(0,5)?function(t,e,r){e||(e=[]);var n=[];return e.forEach((function(e){n.push(G(t,e))})),new U(t,n,r)}(t,r.components||[],r.name||""):""===r.type?new N(t,r.name||""):void e.throwError("invalid type",e.INVALID_ARGUMENT,{arg:"type",value:r.type})}function _(t,r){void 0===r&&(r=O.current),r!==O.current&&(e.checkNormalize(),t=t.normalize(r));for(var n=[],a=0;a<t.length;a++){var i=t.charCodeAt(a);if(i<128)n.push(i);else if(i<2048)n.push(i>>6|192),n.push(63&i|128);else if(55296==(64512&i)){a++;var o=t.charCodeAt(a);if(a>=t.length||56320!=(64512&o))throw new Error("invalid utf-8 string");n.push((i=65536+((1023&i)<<10)+(1023&o))>>18|240),n.push(i>>12&63|128),n.push(i>>6&63|128),n.push(63&i|128)}else n.push(i>>12|224),n.push(i>>6&63|128),n.push(63&i|128)}return e.arrayify(n)||new Uint8Array}function V(t,r){t=e.arrayify(t)||new Uint8Array;for(var n="",a=0;a<t.length;){var i=t[a++];if(i>>7!=0){var o=null,s=null;if(192==(224&i))o=1,s=127;else if(224==(240&i))o=2,s=2047;else{if(240!=(248&i)){if(!r){if(128==(192&i))throw new Error("invalid utf8 byte sequence; unexpected continuation byte");throw new Error("invalid utf8 byte sequence; invalid prefix")}continue}o=3,s=65535}if(a+o>t.length){if(!r)throw new Error("invalid utf8 byte sequence; too short");for(;a<t.length&&t[a]>>6==2;a++);}else{for(var c=i&(1<<8-o-1)-1,u=0;u<o;u++){var h=t[a];if(128!=(192&h)){c=null;break}c=c<<6|63&h,a++}if(null!==c)if(c<=s){if(!r)throw new Error("invalid utf8 byte sequence; overlong")}else if(c>1114111){if(!r)throw new Error("invalid utf8 byte sequence; out-of-range")}else if(c>=55296&&c<=57343){if(!r)throw new Error("invalid utf8 byte sequence; utf-16 surrogate")}else c<=65535?n+=String.fromCharCode(c):(c-=65536,n+=String.fromCharCode(55296+(c>>10&1023),56320+(1023&c)));else if(!r)throw new Error("invalid utf8 byte sequence; invalid continuation byte")}}else n+=String.fromCharCode(i)}return n}function z(t,e){return t&&t._ethersType===e}!function(t){t.current="",t.NFC="NFC",t.NFD="NFD",t.NFKC="NFKC",t.NFKD="NFKD"}(O||(O={}));var K={boolean:!0,number:!0,string:!0};function q(t,e){if(null==t||K[typeof t])return t;if(Array.isArray(t)){var n=t.map((function(t){return q(t,e)}));return e&&Object.freeze(n),n}if("object"==typeof t){if(z(t,"BigNumber"))return t;if(z(t,"Description"))return t;if(z(t,"Indexed"))return t;var a={};for(var i in t){var o=t[i];void 0!==o&&r.defineReadOnly(a,i,q(o,e))}return e&&Object.freeze(a),a}if("function"==typeof t)return t;throw new Error("Cannot deepCopy "+typeof t)}var H=function(){function t(r){e.checkNew(this,t),r||(r=g),this.coerceFunc=r}var r=t.prototype;return r.encode=function(t,r){var n=this;t.length!==r.length&&e.throwError("types/values length mismatch",e.INVALID_ARGUMENT,{count:{types:t.length,values:r.length},value:{types:t,values:r}});var a=[];t.forEach((function(t){var e;e="string"==typeof t?w(t):t,a.push(G(n.coerceFunc,e))}),this);var i=new U(this.coerceFunc,a,"_").encode(r);return e.hexlify(i)},r.decode=function(t,r){var n=this,a=[];return t.forEach((function(t){var e;e="string"==typeof t?w(t):q(t),a.push(G(n.coerceFunc,e))}),this),new U(this.coerceFunc,a,"_").decode(e.arrayify(r)||new Uint8Array,0).value},t}(),W=function(t){return r.isObject(t)&&t.name&&t.name.includes("(")?t.name:t.name+"("+$(!1,t.inputs).join(",")+")"},$=function t(e,n){var a=[];return n.forEach((function(n){if("object"==typeof n.components){if("tuple"!==n.type.substring(0,5))throw new Error("components found but type is not tuple; report on GitHub");var i="",o=n.type.indexOf("[");o>=0&&(i=n.type.substring(o));var s=t(e,n.components);r.isArray(s)&&e?a.push("tuple("+s.join(",")+")"+i):a.push(e?"("+s+")":"("+s.join(",")+")"+i)}else a.push(n.type)})),a};function J(t){return e.BN.isBN(t)?t.toString():t}var Y=function(){function t(t){this.coder=t}var n=t.prototype;return n.encodeFunctionSignature=function(t){return r.isObject(t)&&(t=W(t)),e.keccak256(_(t)).slice(0,10)},n.encodeEventSignature=function(t){return r.isObject(t)&&(t=W(t)),e.keccak256(_(t))},n.encodeParameter=function(t,e){return this.encodeParameters([t],[e])},n.encodeParameters=function(t,e){return this.coder.encode(t,e)},n.encodeFunctionCall=function(t,e){return this.encodeFunctionSignature(t)+this.encodeParameters(t.inputs,e).replace("0x","")},n.decodeParameter=function(t,e){return this.decodeParameters([t],e)[0]},n.decodeParameters=function(t,e){if(r.isArray(t)&&0===t.length)throw new Error("Empty outputs array given!");if(!e||"0x"===e||"0X"===e)throw new Error("Invalid bytes string given: "+e);var n,a=this.coder.decode(t,e),i={};return r.isArray(a)?t.length>1?(t.forEach((function(t,e){"0x"===(n=a[e])&&(n=null),i[e]=J(n),r.isObject(t)&&t.name&&(i[t.name]=J(n))})),i):J(a):(r.isObject(t[0])&&t[0].name&&(i[t[0].name]=J(a)),i[0]=J(a),i)},n.decodeLog=function(t,e,n){var a=this;void 0===e&&(e="");var i,o={},s=0,c=[],u=[];if(r.isArray(n)||(n=[n]),t.forEach((function(t,e){if(t.indexed){if("string"===t.type)return;return i=n[s],a.isStaticType(t.type)&&(i=a.decodeParameter(t.type,n[s])),o[e]=J(i),o[t.name]=J(i),void s++}c.push(e),u.push(t)})),e){var h,l=this.decodeParameters(u,e);c.forEach((function(t,e){o[t]=J(h=l[e]),o[u[e].name]=J(h)}))}return o},n.isStaticType=function(t){return"bytes"!==t&&"string"!==t&&(!t.indexOf("[")||2!==t.slice(t.indexOf("[")).length)},t}();function Z(){return new Y(new H)}var X,Q=function(){function t(t){this.abiItem=t,this.signature=this.abiItem.signature,this.name=this.abiItem.name,this.payable=this.abiItem.payable,this.anonymous=this.abiItem.anonymous,this.type=this.abiItem.type,this.inputs=this.abiItem.inputs,this.outputs=this.abiItem.outputs,this.contractMethodParameters=[]}var e=t.prototype;return e.getInputLength=function(){return r.isArray(this.abiItem.inputs)?this.abiItem.inputs.length:0},e.getInputs=function(){return r.isArray(this.abiItem.inputs)?this.abiItem.inputs:[]},e.getOutputs=function(){return r.isArray(this.abiItem.outputs)?this.abiItem.outputs:[]},e.getIndexedInputs=function(){return this.getInputs().filter((function(t){return!0===t.indexed}))},e.isOfType=function(t){return this.abiItem.type===t},t}(),tt=function(){function t(t){this.abi=t}var e=t.prototype;return e.getMethod=function(t){return!!this.hasMethod(t)&&this.abi.methods[t]},e.getMethods=function(){return this.abi.methods},e.getEvent=function(t){return!!this.hasEvent(t)&&this.abi.events[t]},e.getFallback=function(){return!!this.hasFallback()&&this.abi.fallback},e.getReceive=function(){return!!this.hasReceive()&&this.abi.receive},e.getEvents=function(){return this.abi.events},e.getEventBySignature=function(t){var e,r=this;return Object.keys(this.abi.events).forEach((function(n){r.abi.events[n].signature===t&&(e=r.abi.events[n])})),e},e.hasMethod=function(t){return void 0!==this.abi.methods[t]},e.hasFallback=function(){return void 0!==this.abi.fallback},e.hasReceive=function(){return void 0!==this.abi.receive},e.hasEvent=function(t){return void 0!==this.abi.events[t]},t}(),et=function(t,e){var n={methods:{},events:{},fallback:void 0,receive:void 0},a=!1;return t.forEach((function(t){var i;if(t.constant=rt(t),t.payable=nt(t),t.name&&(t.funcName=W(t)),"function"===t.type)return t.signature=e.encodeFunctionSignature(t.funcName),i=new Q(t),n.methods[t.name]?r.isArray(n.methods[t.name])?n.methods[t.name].push(i):n.methods[t.name]=[n.methods[t.name],i]:n.methods[t.name]=i,n.methods[t.signature]=i,void(n.methods[t.funcName]=i);"event"===t.type&&(t.signature=e.encodeEventSignature(t.funcName),i=new Q(t),n.events[t.name]&&"bound "!==n.events[t.name].name||(n.events[t.name]=i),n.events[t.signature]=i,n.events[t.funcName]=i),"fallback"!==t.type&&"receive"!==t.type||(t.signature=t.type,n[t.type]=new Q(t)),"constructor"===t.type&&(t.signature=t.type,n.methods.contractConstructor=new Q(t),a=!0)})),a||(n.methods.contractConstructor=new Q({inputs:[],payable:!1,constant:!1,type:"constructor"})),new tt(n)},rt=function(t){return"view"===t.stateMutability||"pure"===t.stateMutability||t.constant},nt=function(t){return"payable"===t.stateMutability||t.payable};!function(t){t.INITIALISED="initialised",t.TESTED="tested",t.ERROR="error",t.SIGNED="signed",t.SENT="sent",t.REJECTED="rejected",t.DEPLOYED="deployed",t.CALLED="called"}(X||(X={}));var at=function(){function t(t,e,r,n){this.methodKey=t,this.contract=n,this.wallet=n.wallet,this.params=e,this.abiItem=r,this.transaction=this.createTransaction(),this.callPayload=void 0,this.callResponse=void 0}var n=t.prototype;return n.send=function(t){var e=this;t&&!t.gasLimit&&(t.gasLimit=t.gas);try{var n=t.gasLimit,a=function(){e.transaction=e.transaction.map((function(e){return u({},e,t,{gasLimit:n})}));var r=!t||!1!==t.waitConfirm;e.signTransaction(!t||void 0===t.nonce).then((function(t){e.sendTransaction(t).then((function(t){var n=t[1];e.transaction=t[0],e.contract.transaction=e.transaction,e.transaction.isRejected()?e.transaction.emitter.reject(n):r?e.confirm(n).then((function(){e.transaction.emitter.resolve(e.contract)})):e.transaction.emitter.resolve(e.contract)}))})).catch((function(t){e.transaction.emitter.reject(t)}))};return void 0===n?this.estimateGas(t).then((function(t){n=r.hexToBN(t),a()})):a(),this.transaction.emitter}catch(t){throw t}},n.call=function(){var t=c(a.mark((function t(e,r){var n,i,s,c,h,l,f,d;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(void 0===r&&(r="latest"),e&&!e.gasLimit&&(e.gasLimit=e.gas),t.prev=2,n=void 0!==e&&void 0!==e.shardID?e.shardID:this.contract.shardID,this.transaction=this.transaction.map((function(t){return u({},t,e,{nonce:0})})),i=Object.keys(this.transaction.txPayload),s=this.transaction.txPayload,c={},h=0,l=i;h<l.length;h++)"0x"!==s[f=l[h]]&&(c[f]=s[f]);return t.next=11,this.wallet.messenger.send(o.RPCMethod.Call,[c,r],this.wallet.messenger.chainPrefix,n);case 11:if(d=t.sent,this.callPayload=c,this.callResponse=d,!d.isError()){t.next=18;break}throw d.message;case 18:if(!d.isResult()){t.next=24;break}if(null!==d.result){t.next=23;break}return t.abrupt("return",this.afterCall(void 0));case 23:return t.abrupt("return",this.afterCall(d.result));case 24:t.next=29;break;case 26:throw t.prev=26,t.t0=t.catch(2),t.t0;case 29:case"end":return t.stop()}}),t,this,[[2,26]])})));return function(e,r){return t.apply(this,arguments)}}(),n.estimateGas=function(){var t=c(a.mark((function t(e){var r,n,i,s,c,u;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,r={},n=this.transaction.txPayload,i=0,s=["from","to","gasPrice","value","data"];i<s.length;i++)c=s[i],e&&e[c]?r[c]=e[c]:"0x"!==n[c]&&(r[c]=n[c]);return this.abiItem.isOfType("constructor")&&delete r.to,t.t0=o.getResultForData,t.next=9,this.wallet.messenger.send(o.RPCMethod.EstimateGas,[r]);case 9:if(t.t1=t.sent,"error"!==(u=(0,t.t0)(t.t1)).responseType){t.next=15;break}throw u.message;case 15:if("raw"!==u.responseType){t.next=19;break}throw new Error("Get estimateGas fail");case 19:return t.abrupt("return",u);case 20:t.next=25;break;case 22:throw t.prev=22,t.t2=t.catch(0),t.t2;case 25:case"end":return t.stop()}}),t,this,[[0,22]])})));return function(e){return t.apply(this,arguments)}}(),n.encodeABI=function(){return function(t,e,r){if(!e.isOfType("receive")){if(e.isOfType("fallback"))return e.contractMethodParameters.length?e.contractMethodParameters[0]:void 0;var n=t.encodeParameters(e.getInputs(),e.contractMethodParameters);if(n.startsWith("0x")&&(n=n.slice(2)),e.isOfType("constructor")){if(!r)throw new Error("The contract has no contract data option set. This is necessary to append the constructor parameters.");return r+n}return e.isOfType("function")?e.signature+n:n}}(this.contract.abiCoder,this.abiItem,this.contract.data)},n.debug=function(){return{callResponse:this.callResponse,callPayload:this.callPayload}},n.signTransaction=function(){var t=c(a.mark((function t(e){var r;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!this.wallet.signer){t.next=7;break}return t.next=4,this.wallet.signTransaction(this.transaction,this.wallet.signer,void 0,e,"rlp","latest");case 4:t.t0=t.sent,t.next=10;break;case 7:return t.next=9,this.wallet.signTransaction(this.transaction,e,"rlp","latest");case 9:t.t0=t.sent;case 10:return r=t.t0,this.abiItem.isOfType("constructor")&&(this.contract.address=i.TransactionFactory.getContractAddress(r)),this.contract.setStatus(X.SIGNED),t.abrupt("return",r);case 16:throw t.prev=16,t.t1=t.catch(0),t.t1;case 19:case"end":return t.stop()}}),t,this,[[0,16]])})));return function(e){return t.apply(this,arguments)}}(),n.sendTransaction=function(){var t=c(a.mark((function t(e){var r;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.sendTransaction();case 3:return r=t.sent,this.contract.setStatus(X.SENT),t.abrupt("return",r);case 8:throw t.prev=8,t.t0=t.catch(0),t.t0;case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));return function(e){return t.apply(this,arguments)}}(),n.confirm=function(){var t=c(a.mark((function t(e){var r;return a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.transaction.confirm(e,20,1e3,this.transaction?this.transaction.txParams.shardID:this.contract.shardID);case 3:(r=t.sent).receipt&&r.txStatus===i.TxStatus.CONFIRMED?this.abiItem.isOfType("constructor")?this.contract.setStatus(X.DEPLOYED):this.contract.setStatus(X.CALLED):this.contract.setStatus(X.REJECTED),t.next=10;break;case 7:throw t.prev=7,t.t0=t.catch(0),t.t0;case 10:case"end":return t.stop()}}),t,this,[[0,7]])})));return function(e){return t.apply(this,arguments)}}(),n.createTransaction=function(){if(this.wallet.messenger){this.abiItem.isOfType("constructor")?(this.contract.data=this.params[0].data||"0x",this.abiItem.contractMethodParameters=this.params[0].arguments||[]):this.abiItem.contractMethodParameters=this.params||[];var t=u({},{gasLimit:new r.Unit(21e6).asWei().toWei(),gasPrice:new r.Unit(1).asGwei().toWei()},this.contract.options,this.params[0],{to:this.abiItem.isOfType("constructor")?"0x":e.getAddress(this.contract.address).checksum,data:this.encodeABI()});return new i.TransactionFactory(this.wallet.messenger).newTx(t)}throw new Error("Messenger is not found")},n.afterCall=function(t){if(t.length%32==10&&t.startsWith(this.contract.errorFuncSig))throw{revert:this.contract.abiCoder.decodeParameters([{type:"string"}],"0x"+t.slice(10))[0]};if(this.abiItem.isOfType("constructor")||this.abiItem.isOfType("fallback")||this.abiItem.isOfType("receive"))return t;var e=this.abiItem.getOutputs();if(0===e.length)return t;if(!t||"0x"===t)throw{revert:t};return e.length>1?this.contract.abiCoder.decodeParameters(e,t):this.contract.abiCoder.decodeParameter(e[0],t)},t}(),it=function(){function t(t){this.contract=t,this.abiModel=this.contract.abiModel,this.abiCoder=this.contract.abiCoder,this.methodKeys=this.mapMethodKeys()}var e=t.prototype;return e.addMethodsToContract=function(){var t=this;return this.methodKeys.forEach((function(e){var r={};r[e]=function(){for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return new at(e,n,t.abiModel.getMethod(e),t.contract)},Object.assign(t.contract.methods,r)})),this.abiModel.hasFallback()&&(this.contract.fallback=function(e){return new at("fallback",[e],t.abiModel.getFallback(),t.contract)}),this.abiModel.hasReceive()&&(this.contract.receive=function(){return new at("receive",[],t.abiModel.getReceive(),t.contract)}),this.contract},e.mapMethodKeys=function(){return Object.keys(this.abiModel.abi.methods)},t}(),ot=function(t){return null==t||st(t)?t:e.isHexString(t)?r.isString(t)?t.toLowerCase():t:r.numberToHex(t)},st=function(t){return"latest"===t||"pending"===t||"earliest"===t},ct=function(t){if(r.isAddress(t))return"0x"+t.toLowerCase().replace("0x","");throw new Error('Provided address "'+t+"\" is invalid, the capitalization checksum test failed, or its an indrect IBAN address which can't be converted.")},ut=function(t){return null==t?null:0===(t=String(t)).indexOf("0x")?t:e.hexlify(_(t))},ht=function(t){function n(e,n,a,i){var o,s;return(o=t.call(this,((s=n).fromBlock&&(s.fromBlock=ot(s.fromBlock)),s.toBlock&&(s.toBlock=ot(s.toBlock)),s.topics=s.topics||[],s.topics=s.topics.map((function(t){return r.isArray(t)?t.map(ut):ut(t)})),s.address&&(s.address=r.isArray(s.address)?s.address.map((function(t){return ct(t)})):ct(s.address)),s),i.wallet.messenger,i.shardID)||this).methodKey=e,o.contract=i,o.params=n,o.abiItem=a,o}return h(n,t),n.prototype.onNewSubscriptionItem=function(t){var n,a,i,o,s=function(t){if("string"==typeof t.blockHash&&"string"==typeof t.transactionHash&&"string"==typeof t.logIndex){var n=e.keccak256("0x"+t.blockHash.replace("0x","")+t.transactionHash.replace("0x","")+t.logIndex.replace("0x",""));n.replace("0x","").substr(0,8),t.id="log_"+n}else t.id||(t.id=null);return null!==t.blockNumber&&(t.blockNumber=r.hexToBN(t.blockNumber).toNumber()),null!==t.transactionIndex&&(t.transactionIndex=r.hexToBN(t.transactionIndex).toNumber()),null!==t.logIndex&&(t.logIndex=r.hexToBN(t.logIndex).toNumber()),t.address&&(t.address=e.toChecksumAddress(t.address)),t}(void 0!==t.method?t.params.result:t),c=(n=this.contract.abiCoder,o=(i=s).topics,(a=this.abiItem).anonymous||(o=i.topics.slice(1)),"0x"===i.data&&(i.data=null),i.returnValues=n.decodeLog(a.getInputs(),i.data,o),i.event=a.name,i.signature=a.signature,i.raw={data:i.data,topics:i.topics},!a.anonymous&&i.topics[0]||(i.signature=null),delete i.data,delete i.topics,i);return c.removed&&this.emitter&&this.emitter.emit("changed",c),c},n}(o.LogSub),lt=function(){function t(t){this.contract=t,this.abiModel=this.contract.abiModel,this.abiCoder=this.contract.abiCoder,this.eventKeys=this.mapEventKeys()}var e=t.prototype;return e.addEventsToContract=function(){var t=this;return this.eventKeys.forEach((function(e){var r={};r[e]=function(r){return new ht(e,t.map(t.abiModel.getEvent(e),t.contract,r),t.abiModel.getEvent(e),t.contract)},Object.assign(t.contract.events,r)})),this.contract},e.mapEventKeys=function(){return Object.keys(this.abiModel.abi.events)},e.map=function(t,e,n){return n||(n={}),r.isArray(n.topics)||(n.topics=[]),void 0!==n.fromBlock&&(n.fromBlock=ot(n.fromBlock)),void 0!==n.toBlock&&(n.toBlock=ot(n.toBlock)),void 0!==n.filter&&(n.topics=n.topics.concat(function(t,e,n){var a=[];return e.getIndexedInputs().forEach((function(e){if(n[e.name]){var i=n[e.name];return r.isArray(i)?(i=i.map((function(r){return t.encodeParameter(e.type,r)})),void a.push(i)):void a.push(t.encodeParameter(e.type,i))}a.push(null)})),a}(this.abiCoder,t,n.filter)),delete n.filter),t.anonymous||n.topics.unshift(t.signature),n.address||(n.address=e.address),n},t}(),ft=function(){function t(t,e,r,n,a){void 0===t&&(t=[]),void 0===e&&(e="0x"),void 0===r&&(r={}),void 0===a&&(a=X.INITIALISED),this.fallback=void 0,this.receive=void 0,this.abi=[],this.errorFunc="Error(string)",this.abi=t,this.abiCoder=Z(),this.abiModel=et(t,this.abiCoder),this.options=r,this.address=this.options.address||e,this.shardID=this.options.shardID||n.messenger.currentShard,this.wallet=n,this.methods={},this.events={},this.runMethodFactory(),this.runEventFactory(),this.status=a,this.errorFuncSig=this.abiCoder.encodeFunctionSignature(this.errorFunc)}var e,r,a=t.prototype;return a.isInitialised=function(){return this.status===X.INITIALISED},a.isSigned=function(){return this.status===X.SIGNED},a.isSent=function(){return this.status===X.SENT},a.isDeployed=function(){return this.status===X.DEPLOYED},a.isRejected=function(){return this.status===X.REJECTED},a.isCalled=function(){return this.status===X.CALLED},a.setStatus=function(t){this.status=t},a.deploy=function(t){return this.methods.contractConstructor(t)},a.runMethodFactory=function(){return new it(this).addMethodsToContract()},a.runEventFactory=function(){return new lt(this).addEventsToContract()},a.connect=function(t){this.wallet=t},a.setMessegner=function(t){this.wallet instanceof n.Wallet?this.wallet.setMessenger(t):this.wallet.messenger=t},e=t,(r=[{key:"jsonInterface",get:function(){return this.abiModel},set:function(t){this.abiModel=et(t,this.abiCoder),this.runMethodFactory(),this.runEventFactory()}},{key:"address",get:function(){return this.options.address||this.address},set:function(t){this.options.address=t}},{key:"data",get:function(){return this.options.data},set:function(t){this.options.data=t}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),dt=function(){function t(t){this.wallet=t}return t.prototype.createContract=function(t,e,r){return new ft(t,e,r,this.wallet)},t}();exports.AbiCoder=Z,exports.Contract=ft,exports.ContractFactory=dt,exports.formatBytes32String=function(t){var r=_(t);if(r.length>31)throw new Error("bytes32 string must be less than 32 bytes");return e.hexlify(e.concat([r,"0x0000000000000000000000000000000000000000000000000000000000000000"]).slice(0,32))},exports.parseBytes32String=function(t){var r=e.arrayify(t)||new Uint8Array;if(32!==r.length)throw new Error("invalid bytes32 - not 32 bytes long");if(0!==r[31])throw new Error("invalid bytes32 sdtring - no null terminator");for(var n=31;0===r[n-1];)n--;return V(r.slice(0,n))},exports.toUtf8Bytes=_,exports.toUtf8String=V;
//# sourceMappingURL=avalanche-js-contract.cjs.production.min.js.map
